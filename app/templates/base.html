<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Ubuntu Server Dashboard{% endblock %}</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'dark': {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a',
                        },
                        'accent': {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        }
                    },
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-in',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'slide-down': 'slideDown 0.3s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            'from': { opacity: '0' },
                            'to': { opacity: '1' },
                        },
                        slideUp: {
                            'from': { opacity: '0', transform: 'translateY(20px)' },
                            'to': { opacity: '1', transform: 'translateY(0)' },
                        },
                        slideDown: {
                            'from': { opacity: '0', transform: 'translateY(-20px)' },
                            'to': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom component styles that extend Tailwind */
        .glass-effect {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(148, 163, 184, 0.1);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }
        
        .nav-link-active {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }
        
        .loading-shimmer {
            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
            animation: shimmer 1.5s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* Custom scrollbar for webkit browsers */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1e293b;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
        
        /* Mobile menu transition */
        .mobile-menu {
            transform: translateY(-100vh);
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        
        .mobile-menu.active {
            transform: translateY(0);
        }
    </style>
    {% block styles %}{% endblock %}
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen flex flex-col font-inter antialiased">
    {% if current_user.is_authenticated %}
    <!-- Navigation -->
    <nav class="glass-effect sticky top-0 z-50 border-b border-slate-700">
        <div class="max-w-7xl mx-auto px-4 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Brand -->
                <a href="{{ url_for('main.index') }}" class="flex items-center gap-3 text-white hover:text-blue-400 transition-colors duration-200 font-bold text-xl">
                    <i class="fas fa-server text-blue-400"></i>
                    <span class="hidden sm:block">Ubuntu Dashboard</span>
                    <span class="sm:hidden">Dashboard</span>
                </a>

                <!-- Desktop Navigation -->
                <div class="hidden lg:flex items-center space-x-1">
                    <a href="{{ url_for('main.index') }}" class="flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200 {{ 'nav-link-active' if request.endpoint == 'main.index' else 'text-slate-300 hover:text-white hover:bg-slate-700' }}">
                        <i class="fas fa-tachometer-alt w-4"></i>
                        Dashboard
                    </a>
                    
                    <a href="{{ url_for('main.chat') }}" class="flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200 {{ 'nav-link-active' if request.endpoint == 'main.chat' else 'text-slate-300 hover:text-white hover:bg-slate-700' }}">
                        <i class="fas fa-comments w-4"></i>
                        Chat
                    </a>
                    
                    <a href="{{ url_for('main.profile') }}" class="flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200 {{ 'nav-link-active' if request.endpoint == 'main.profile' else 'text-slate-300 hover:text-white hover:bg-slate-700' }}">
                        <i class="fas fa-user w-4"></i>
                        Profile
                    </a>
                    
                    {% if current_user.is_admin() %}
                        <a href="{{ url_for('main.service_control') }}" class="flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200 {{ 'nav-link-active' if request.endpoint == 'main.service_control' else 'text-slate-300 hover:text-white hover:bg-slate-700' }}">
                            <i class="fas fa-cogs w-4"></i>
                            Services
                        </a>
                        
                        <a href="{{ url_for('main.terminal') }}" class="flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200 {{ 'nav-link-active' if request.endpoint == 'main.terminal' else 'text-slate-300 hover:text-white hover:bg-slate-700' }}">
                            <i class="fas fa-terminal w-4"></i>
                            Terminal
                        </a>
                        
                        <a href="{{ url_for('main.metrics') }}" class="flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200 {{ 'nav-link-active' if request.endpoint == 'main.metrics' else 'text-slate-300 hover:text-white hover:bg-slate-700' }}">
                            <i class="fas fa-chart-line w-4"></i>
                            Metrics
                        </a>
                        
                        <!-- Admin Dropdown -->
                        <div class="relative group ml-2">
                            <button class="flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium text-slate-300 hover:text-white hover:bg-slate-700 transition-all duration-200">
                                <i class="fas fa-cog w-4"></i>
                                Admin
                                <i class="fas fa-chevron-down text-xs ml-1"></i>
                            </button>
                            <div class="absolute right-0 top-full mt-2 w-48 glass-effect border border-slate-600 rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transform translate-y-1 group-hover:translate-y-0 transition-all duration-200 z-50">
                                <a href="{{ url_for('admin.users') }}" class="flex items-center gap-3 px-4 py-3 text-sm text-slate-300 hover:text-white hover:bg-slate-700 transition-colors duration-200 first:rounded-t-lg">
                                    <i class="fas fa-users w-4"></i>
                                    Users
                                </a>
                                <a href="{{ url_for('admin.services') }}" class="flex items-center gap-3 px-4 py-3 text-sm text-slate-300 hover:text-white hover:bg-slate-700 transition-colors duration-200">
                                    <i class="fas fa-server w-4"></i>
                                    System
                                </a>
                                <a href="{{ url_for('admin.audit_logs') }}" class="flex items-center gap-3 px-4 py-3 text-sm text-slate-300 hover:text-white hover:bg-slate-700 transition-colors duration-200 last:rounded-b-lg">
                                    <i class="fas fa-list w-4"></i>
                                    Logs
                                </a>
                            </div>
                        </div>
                    {% endif %}
                    
                    <!-- User Logout -->
                    <a href="{{ url_for('auth.logout') }}" class="flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium text-slate-300 hover:text-white hover:bg-slate-700 transition-all duration-200 ml-4">
                        <i class="fas fa-sign-out-alt w-4"></i>
                        <span class="hidden xl:block">Logout</span>
                    </a>
                </div>

                <!-- Mobile menu button -->
                <button id="mobileMenuBtn" class="lg:hidden flex items-center justify-center w-10 h-10 rounded-lg text-slate-300 hover:text-white hover:bg-slate-700 transition-colors duration-200">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>

        <!-- Mobile Navigation -->
        <div id="mobileMenu" class="mobile-menu lg:hidden glass-effect border-t border-slate-700">
            <div class="px-4 py-4 space-y-2">
                <a href="{{ url_for('main.index') }}" class="flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium {{ 'nav-link-active' if request.endpoint == 'main.index' else 'text-slate-300 hover:text-white hover:bg-slate-700' }} transition-all duration-200">
                    <i class="fas fa-tachometer-alt w-5"></i>
                    Dashboard
                </a>
                
                <a href="{{ url_for('main.chat') }}" class="flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium {{ 'nav-link-active' if request.endpoint == 'main.chat' else 'text-slate-300 hover:text-white hover:bg-slate-700' }} transition-all duration-200">
                    <i class="fas fa-comments w-5"></i>
                    Chat
                </a>
                
                <a href="{{ url_for('main.profile') }}" class="flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium {{ 'nav-link-active' if request.endpoint == 'main.profile' else 'text-slate-300 hover:text-white hover:bg-slate-700' }} transition-all duration-200">
                    <i class="fas fa-user w-5"></i>
                    Profile
                </a>
                
                {% if current_user.is_admin() %}
                    <div class="border-t border-slate-600 pt-3 mt-3">
                        <p class="px-4 py-2 text-xs font-semibold text-slate-400 uppercase tracking-wider">Admin</p>
                        <a href="{{ url_for('main.service_control') }}" class="flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium {{ 'nav-link-active' if request.endpoint == 'main.service_control' else 'text-slate-300 hover:text-white hover:bg-slate-700' }} transition-all duration-200">
                            <i class="fas fa-cogs w-5"></i>
                            Services
                        </a>
                        
                        <a href="{{ url_for('main.terminal') }}" class="flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium {{ 'nav-link-active' if request.endpoint == 'main.terminal' else 'text-slate-300 hover:text-white hover:bg-slate-700' }} transition-all duration-200">
                            <i class="fas fa-terminal w-5"></i>
                            Terminal
                        </a>
                        
                        <a href="{{ url_for('main.metrics') }}" class="flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium {{ 'nav-link-active' if request.endpoint == 'main.metrics' else 'text-slate-300 hover:text-white hover:bg-slate-700' }} transition-all duration-200">
                            <i class="fas fa-chart-line w-5"></i>
                            Metrics
                        </a>
                        
                        <a href="{{ url_for('admin.users') }}" class="flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium text-slate-300 hover:text-white hover:bg-slate-700 transition-all duration-200">
                            <i class="fas fa-users w-5"></i>
                            Users
                        </a>
                        
                        <a href="{{ url_for('admin.services') }}" class="flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium text-slate-300 hover:text-white hover:bg-slate-700 transition-all duration-200">
                            <i class="fas fa-server w-5"></i>
                            System
                        </a>
                        
                        <a href="{{ url_for('admin.audit_logs') }}" class="flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium text-slate-300 hover:text-white hover:bg-slate-700 transition-all duration-200">
                            <i class="fas fa-list w-5"></i>
                            Audit Logs
                        </a>
                    </div>
                {% endif %}
                
                <div class="border-t border-slate-600 pt-3 mt-3">
                    <a href="{{ url_for('auth.logout') }}" class="flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium text-slate-300 hover:text-white hover:bg-slate-700 transition-all duration-200">
                        <i class="fas fa-sign-out-alt w-5"></i>
                        Logout
                    </a>
                </div>
            </div>
        </div>
    </nav>
    {% endif %}

    <main class="max-w-7xl mx-auto px-4 lg:px-8 py-6 flex-1 animate-fade-in">
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        <div class="mb-6 p-4 rounded-lg border-l-4 flex items-center gap-3 animate-slide-up 
                   {{ 'bg-green-500/10 border-green-500 text-green-400' if category == 'success' 
                   else 'bg-red-500/10 border-red-500 text-red-400' if category == 'error' 
                   else 'bg-yellow-500/10 border-yellow-500 text-yellow-400' if category == 'warning' 
                   else 'bg-blue-500/10 border-blue-500 text-blue-400' }}">
            <i class="fas fa-{{ 'check-circle' if category == 'success' else 'exclamation-triangle' if category == 'warning' else 'times-circle' if category == 'error' else 'info-circle' }} text-lg"></i>
            <span>{{ message }}</span>
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </main>

    <footer class="bg-slate-800 border-t border-slate-700 py-6 mt-12">
        <div class="max-w-7xl mx-auto px-4 lg:px-8 text-center text-slate-400 text-sm">
            <p>&copy; 2024 Ubuntu Server Dashboard. Built with Flask and modern design.</p>
        </div>
    </footer>

    <script>
        // Auto-hide alerts after 5 seconds
        document.addEventListener('DOMContentLoaded', function() {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(function(alert) {
                setTimeout(function() {
                    alert.style.opacity = '0';
                    setTimeout(function() {
                        alert.remove();
                    }, 300);
                }, 5000);
            });

            // Hamburger menu functionality
            const navbarToggle = document.getElementById('navbar-toggle');
            const navbarNav = document.getElementById('navbar-nav');
            const navLinks = document.querySelectorAll('.nav-link');
            const adminDropdowns = document.querySelectorAll('.admin-dropdown');

            if (navbarToggle && navbarNav) {
                navbarToggle.addEventListener('click', function() {
                    navbarNav.classList.toggle('active');
                    
                    // Change hamburger icon
                    const icon = navbarToggle.querySelector('i');
                    if (navbarNav.classList.contains('active')) {
                        icon.className = 'fas fa-times';
                    } else {
                        icon.className = 'fas fa-bars';
                    }
                });

                // Close menu when clicking on a regular link (not dropdown triggers)
                navLinks.forEach(function(link) {
                    if (!link.closest('.admin-dropdown') || link.closest('.admin-dropdown-content')) {
                        link.addEventListener('click', function(e) {
                            // Don't close for dropdown triggers on desktop
                            if (window.innerWidth > 768 && link.getAttribute('href') === '#') {
                                e.preventDefault();
                                return;
                            }
                            
                            navbarNav.classList.remove('active');
                            const icon = navbarToggle.querySelector('i');
                            icon.className = 'fas fa-bars';
                        });
                    }
                });

                // Handle dropdown click for mobile
                adminDropdowns.forEach(function(dropdown) {
                    const trigger = dropdown.querySelector('a[href="#"]');
                    if (trigger) {
                        trigger.addEventListener('click', function(e) {
                            if (window.innerWidth <= 768) {
                                e.preventDefault();
                                const content = dropdown.querySelector('.admin-dropdown-content');
                                if (content) {
                                    content.style.display = content.style.display === 'block' ? 'none' : 'block';
                                }
                            }
                        });
                    }
                });

                // Close menu when clicking outside
                document.addEventListener('click', function(event) {
                    const isClickInsideNav = navbarNav.contains(event.target);
                    const isClickOnToggle = navbarToggle.contains(event.target);
                    
                    if (!isClickInsideNav && !isClickOnToggle && navbarNav.classList.contains('active')) {
                        navbarNav.classList.remove('active');
                        const icon = navbarToggle.querySelector('i');
                        icon.className = 'fas fa-bars';
                    }
                });

                // Close menu on window resize if becoming larger
                window.addEventListener('resize', function() {
                    if (window.innerWidth > 768 && navbarNav.classList.contains('active')) {
                        navbarNav.classList.remove('active');
                        const icon = navbarToggle.querySelector('i');
                        icon.className = 'fas fa-bars';
                    }
                });
            }
        });
    </script>
    <script>
        // Mobile menu toggle
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const mobileMenu = document.getElementById('mobileMenu');
            
            if (mobileMenuBtn && mobileMenu) {
                mobileMenuBtn.addEventListener('click', function() {
                    mobileMenu.classList.toggle('active');
                    
                    // Toggle icon
                    const icon = mobileMenuBtn.querySelector('i');
                    if (mobileMenu.classList.contains('active')) {
                        icon.classList.remove('fa-bars');
                        icon.classList.add('fa-times');
                    } else {
                        icon.classList.remove('fa-times');
                        icon.classList.add('fa-bars');
                    }
                });
                
                // Close mobile menu when clicking outside
                document.addEventListener('click', function(event) {
                    if (!mobileMenuBtn.contains(event.target) && !mobileMenu.contains(event.target)) {
                        mobileMenu.classList.remove('active');
                        const icon = mobileMenuBtn.querySelector('i');
                        icon.classList.remove('fa-times');
                        icon.classList.add('fa-bars');
                    }
                });
                
                // Close mobile menu on window resize if screen becomes large
                window.addEventListener('resize', function() {
                    if (window.innerWidth >= 1024) {
                        mobileMenu.classList.remove('active');
                        const icon = mobileMenuBtn.querySelector('i');
                        icon.classList.remove('fa-times');
                        icon.classList.add('fa-bars');
                    }
                });
            }
        });
    </script>
    {% block scripts %}{% endblock %}
</body>
</html>
